# mockd.yaml - gRPC Service Template
# Generated by: mockd init --template grpc-service
# Documentation: https://mockd.io/docs
#
# This template provides a gRPC Greeter service with:
# - SayHello unary RPC
# - SayHelloStream server streaming RPC
# - Reflection enabled for tooling
#
# Start server: mockd serve --config mockd.yaml
# Test: grpcurl -plaintext localhost:50051 list

version: "1.0"

mocks:
  # gRPC Greeter Service
  - id: grpc-grpc-greeter
    name: Greeter Service
    type: grpc
    enabled: true
    grpc:
      # gRPC server port
      port: 50051
      # Proto file definition (inline or file reference)
      # For file reference, use: protoFile: ./greeter.proto
      protoFile: |
        syntax = "proto3";

        package helloworld;

        option go_package = "github.com/example/helloworld";

        // The greeting service definition
        service Greeter {
          // Sends a greeting
          rpc SayHello (HelloRequest) returns (HelloReply) {}
          // Sends multiple greetings
          rpc SayHelloStream (HelloRequest) returns (stream HelloReply) {}
          // Receives multiple names and returns a single greeting
          rpc SayHelloClientStream (stream HelloRequest) returns (HelloReply) {}
          // Bidirectional streaming
          rpc SayHelloBidiStream (stream HelloRequest) returns (stream HelloReply) {}
        }

        // The request message containing the user's name
        message HelloRequest {
          string name = 1;
          string language = 2;
        }

        // The response message containing the greetings
        message HelloReply {
          string message = 1;
          string timestamp = 2;
        }

      # Enable gRPC reflection for tooling (grpcurl, grpc-web, etc.)
      reflection: true
      # Service method configurations
      services:
        helloworld.Greeter:
          methods:
            # Unary RPC: SayHello
            SayHello:
              response:
                message: "Hello, World!"
                timestamp: "{{now}}"
              # Match specific request values (optional)
              # match:
              #   request:
              #     name: "Alice"

            # Server streaming RPC: SayHelloStream
            SayHelloStream:
              # Multiple responses for streaming
              responses:
                - message: "Hello! (1/3)"
                  timestamp: "{{now}}"
                - message: "Hello again! (2/3)"
                  timestamp: "{{now}}"
                - message: "Hello one more time! (3/3)"
                  timestamp: "{{now}}"
              # Delay between stream messages
              streamDelay: "500ms"

            # Client streaming RPC: SayHelloClientStream
            SayHelloClientStream:
              response:
                message: "Hello to all of you!"
                timestamp: "{{now}}"

            # Bidirectional streaming RPC: SayHelloBidiStream
            SayHelloBidiStream:
              response:
                message: "Echo: Hello!"
                timestamp: "{{now}}"

  # HTTP endpoint for gRPC service info
  - id: grpc-grpc-info
    name: gRPC Service Info
    type: http
    enabled: true
    http:
      matcher:
        method: GET
        path: /grpc/info
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {
            "service": "helloworld.Greeter",
            "port": 50051,
            "reflection": true,
            "methods": [
              {
                "name": "SayHello",
                "type": "unary",
                "description": "Simple greeting"
              },
              {
                "name": "SayHelloStream",
                "type": "server_stream",
                "description": "Multiple greetings"
              },
              {
                "name": "SayHelloClientStream",
                "type": "client_stream",
                "description": "Greet multiple people"
              },
              {
                "name": "SayHelloBidiStream",
                "type": "bidi_stream",
                "description": "Bidirectional greeting"
              }
            ],
            "tools": {
              "grpcurl": "grpcurl -plaintext localhost:50051 helloworld.Greeter/SayHello",
              "list": "grpcurl -plaintext localhost:50051 list"
            }
          }

  # Health check for gRPC
  - id: grpc-health-check
    name: Health Check
    type: http
    enabled: true
    http:
      matcher:
        method: GET
        path: /health
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {"status": "ok", "grpc_port": 50051}

# Next steps:
# 1. Run: mockd serve --config mockd.yaml
# 2. Install grpcurl: https://github.com/fullstorydev/grpcurl
# 3. List services:
#    grpcurl -plaintext localhost:50051 list
# 4. Describe service:
#    grpcurl -plaintext localhost:50051 describe helloworld.Greeter
# 5. Call SayHello:
#    grpcurl -plaintext -d '{"name": "World"}' localhost:50051 helloworld.Greeter/SayHello
# 6. Call streaming:
#    grpcurl -plaintext -d '{"name": "World"}' localhost:50051 helloworld.Greeter/SayHelloStream
# 7. For your own service, create a .proto file and reference it:
#    protoFile: ./your-service.proto
