# mockd.yaml - WebSocket Chat Template
# Generated by: mockd init --template websocket-chat
# Documentation: https://mockd.io/docs
#
# This template provides a WebSocket chat room mock with:
# - Echo mode for testing
# - Message matchers for specific responses
# - Heartbeat/keepalive support
#
# Start server: mockd serve --config mockd.yaml
# Test: wscat -c ws://localhost:4280/ws/chat

version: "1.0"

mocks:
  # WebSocket Chat Room
  # Connect: ws://localhost:4280/ws/chat
  - id: ws-websocket-chat
    name: Chat Room
    type: websocket
    enabled: true
    websocket:
      path: /ws/chat
      # Supported subprotocols (optional)
      subprotocols:
        - chat
        - json
      # Echo mode: automatically echo back received messages
      echoMode: true
      # Connection limits
      maxMessageSize: 65536
      idleTimeout: "5m"
      maxConnections: 100
      # Heartbeat to keep connections alive
      heartbeat:
        enabled: true
        interval: "30s"
        timeout: "10s"
      # Message matchers for specific responses
      matchers:
        # Respond to "ping" with "pong"
        - match:
            type: exact
            value: "ping"
          response:
            type: text
            value: "pong"
        # Respond to JSON messages with type: "join"
        - match:
            type: json
            path: "$.type"
            value: "join"
          response:
            type: json
            value:
              type: "joined"
              message: "Welcome to the chat room!"
              timestamp: "{{now}}"
        # Respond to JSON messages with type: "message"
        - match:
            type: json
            path: "$.type"
            value: "message"
          response:
            type: json
            value:
              type: "message"
              from: "server"
              content: "Message received!"
              timestamp: "{{now}}"
        # Respond to "status" command
        - match:
            type: exact
            value: "status"
          response:
            type: json
            value:
              type: "status"
              connections: 1
              uptime: "{{timestamp}}"
        # Respond to "help" command
        - match:
            type: exact
            value: "help"
          response:
            type: text
            value: |
              Available commands:
              - ping: Test connection
              - status: Get server status
              - help: Show this help
              - {"type": "join", "username": "..."}: Join chat
              - {"type": "message", "content": "..."}: Send message
      # Default response when no matcher matches
      defaultResponse:
        type: json
        value:
          type: "echo"
          received: "{{message}}"
          timestamp: "{{now}}"

  # WebSocket Echo endpoint (simple)
  # Connect: ws://localhost:4280/ws/echo
  - id: ws-websocket-echo
    name: Echo WebSocket
    type: websocket
    enabled: true
    websocket:
      path: /ws/echo
      echoMode: true
      maxMessageSize: 65536
      heartbeat:
        enabled: true
        interval: "30s"

  # HTTP endpoint for WebSocket info
  - id: ws-ws-info
    name: WebSocket Info
    type: http
    enabled: true
    http:
      matcher:
        method: GET
        path: /ws/info
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {
            "endpoints": [
              {
                "path": "/ws/chat",
                "description": "Chat room with message matching",
                "subprotocols": ["chat", "json"]
              },
              {
                "path": "/ws/echo",
                "description": "Simple echo WebSocket"
              }
            ],
            "usage": {
              "connect": "wscat -c ws://localhost:4280/ws/chat",
              "commands": ["ping", "status", "help"]
            }
          }

# Next steps:
# 1. Run: mockd serve --config mockd.yaml
# 2. Install wscat: npm install -g wscat
# 3. Connect: wscat -c ws://localhost:4280/ws/chat
# 4. Test commands:
#    - Type "ping" to receive "pong"
#    - Type "help" for available commands
#    - Send JSON: {"type": "join", "username": "user1"}
# 5. For echo-only: wscat -c ws://localhost:4280/ws/echo
# 6. Customize matchers for your specific chat protocol
