# mockd.yaml - CRUD API Template
# Generated by: mockd init --template crud
# Documentation: https://mockd.io/docs
#
# This template provides a full REST CRUD API for a "resources" entity.
# Includes: List, Create, Read, Update, Delete operations.
#
# Start server:  mockd serve --config mockd.yaml
# Test endpoint: curl http://localhost:4280/api/resources

version: "1.0"

mocks:
  # List all resources
  # GET /api/resources
  - id: crud-list-resources
    name: List Resources
    type: http
    enabled: true
    http:
      priority: 10
      matcher:
        method: GET
        path: /api/resources
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {
            "data": [
              {"id": "res_001", "name": "Resource One", "status": "active", "createdAt": "2024-01-15T10:30:00Z"},
              {"id": "res_002", "name": "Resource Two", "status": "pending", "createdAt": "2024-01-16T14:20:00Z"},
              {"id": "res_003", "name": "Resource Three", "status": "active", "createdAt": "2024-01-17T09:15:00Z"}
            ],
            "meta": {
              "total": 3,
              "page": 1,
              "perPage": 20
            }
          }

  # Create a new resource
  # POST /api/resources
  - id: crud-create-resource
    name: Create Resource
    type: http
    enabled: true
    http:
      matcher:
        method: POST
        path: /api/resources
      response:
        statusCode: 201
        headers:
          Content-Type: application/json
          Location: /api/resources/res_{{uuid}}
        body: |
          {
            "id": "res_{{uuid}}",
            "name": "{{jsonPath request.body '$.name'}}",
            "status": "pending",
            "createdAt": "{{now}}",
            "updatedAt": "{{now}}"
          }

  # Get a single resource by ID
  # GET /api/resources/{id}
  - id: crud-get-resource
    name: Get Resource
    type: http
    enabled: true
    http:
      matcher:
        method: GET
        path: /api/resources/{id}
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {
            "id": "{{request.pathParam.id}}",
            "name": "Resource Details",
            "status": "active",
            "description": "This is a detailed view of the resource",
            "metadata": {
              "version": 1,
              "tags": ["example", "mock"]
            },
            "createdAt": "2024-01-15T10:30:00Z",
            "updatedAt": "2024-01-18T16:45:00Z"
          }

  # Update a resource
  # PUT /api/resources/{id}
  - id: crud-update-resource
    name: Update Resource
    type: http
    enabled: true
    http:
      matcher:
        method: PUT
        path: /api/resources/{id}
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {
            "id": "{{request.pathParam.id}}",
            "name": "{{jsonPath request.body '$.name'}}",
            "status": "{{jsonPath request.body '$.status'}}",
            "updatedAt": "{{now}}"
          }

  # Partial update a resource
  # PATCH /api/resources/{id}
  - id: crud-patch-resource
    name: Patch Resource
    type: http
    enabled: true
    http:
      matcher:
        method: PATCH
        path: /api/resources/{id}
      response:
        statusCode: 200
        headers:
          Content-Type: application/json
        body: |
          {
            "id": "{{request.pathParam.id}}",
            "name": "Patched Resource",
            "status": "active",
            "updatedAt": "{{now}}"
          }

  # Delete a resource
  # DELETE /api/resources/{id}
  - id: crud-delete-resource
    name: Delete Resource
    type: http
    enabled: true
    http:
      matcher:
        method: DELETE
        path: /api/resources/{id}
      response:
        statusCode: 204
        headers:
          Content-Type: application/json
        body: ""

  # Resource not found example (higher priority pattern)
  # Use this pattern to simulate 404 for specific IDs
  - id: crud-resource-not-found
    name: Resource Not Found
    type: http
    enabled: true
    http:
      priority: 100
      matcher:
        method: GET
        path: /api/resources/not-found
      response:
        statusCode: 404
        headers:
          Content-Type: application/json
        body: |
          {
            "error": {
              "code": "RESOURCE_NOT_FOUND",
              "message": "The requested resource was not found",
              "details": {
                "resourceId": "not-found"
              }
            }
          }

  # Validation error example
  - id: crud-validation-error
    name: Validation Error
    type: http
    enabled: true
    http:
      priority: 100
      matcher:
        method: POST
        path: /api/resources
        bodyContains: '"name": ""'
      response:
        statusCode: 400
        headers:
          Content-Type: application/json
        body: |
          {
            "error": {
              "code": "VALIDATION_ERROR",
              "message": "Request validation failed",
              "details": {
                "fields": [
                  {"field": "name", "message": "Name is required"}
                ]
              }
            }
          }

# Next steps:
# 1. Run: mockd serve --config mockd.yaml
# 2. List: curl http://localhost:4280/api/resources
# 3. Create: curl -X POST http://localhost:4280/api/resources -H "Content-Type: application/json" -d '{"name": "New Resource"}'
# 4. Get: curl http://localhost:4280/api/resources/res_001
# 5. Update: curl -X PUT http://localhost:4280/api/resources/res_001 -H "Content-Type: application/json" -d '{"name": "Updated", "status": "active"}'
# 6. Delete: curl -X DELETE http://localhost:4280/api/resources/res_001
# 7. Customize the resource structure and add more endpoints as needed
